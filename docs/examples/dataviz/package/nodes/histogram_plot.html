<!DOCTYPE html>
<html>

<!-- the head allows this page to be loaded standalone to test the layout, but is ignored by skadi -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

    <link href="https://visualtopology.github.io/exo/versions/latest/exo.css" rel="stylesheet" type="text/css">
    <link href="https://visualtopology.github.io/exo/versions/latest/exo-icons.css" rel="stylesheet" type="text/css">
    <script src="https://visualtopology.github.io/exo/versions/latest/exo.js" type="text/javascript"></script>

    <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.6.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.2"></script>

    <script src="../../../../versions/latest/skadi-ui.js" type="text/javascript"></script>

    <link href="chart_layout.css" rel="stylesheet" type="text/css">
    <script>
        var dataset = undefined;

        skadiui.set_message_handler((msg) => {
                let vizdiv = document.getElementById("vizdiv");
                vizdiv.innerHTML = "";
                if (msg.dataset) {
                    dataset = msg.dataset;
                } else if ("x_col" in msg) {
                    let r = vizdiv.getBoundingClientRect();
                    let h = r.height;
                    let w = r.width;
                    let spec = {
                        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                        "data": { "format": {"type": "csv"}, "values": dataset },
                        "mark": "bar",
                        "width": w,
                        "height": h - 40,
                        "padding": 20,
                        "autosize": {
                          "type": "fit",
                          "contains": "padding"
                        },
                        "encoding": {
                            "x": {
                                "field": msg.x_col
                            },
                            "y": {"aggregate": "count"},
                            "tooltip": {"aggregate": "count"}
                        }
                    }
                    if (msg.use_custom_settings) {
                        spec["encoding"]["x"]["bin"] = {
                            "step": msg.custom_band_width
                        }
                    }
                    if (msg.title) {
                        spec["title"] =  { "text": msg.title };
                    }
                    if (msg.x_axis_label) {
                        spec.encoding.x.title = msg.x_axis_label;
                    }
                     if (msg.y_axis_label) {
                        spec.encoding.y.title = msg.y_axis_label;
                    }
                    if (msg.h_col) {
                        spec["encoding"]["color"] = {"field":msg.h_col, "type": "nominal"};
                    }
                    vegaEmbed(vizdiv, spec, {"theme": msg.theme, "defaultStyle":false,"actions":{"export":true, "source":false, "compiled":false, "editor":false}});
                }
            });
    </script>
</head>

<body>
    <div id="flexroot">
        <div class="exo-row">
            <div class="exo-2-cell">
                <exo-select id="x_axis" label="X-Axis">
                </exo-select>
            </div>
            <div class="exo-2-cell">
                <exo-select id="hue" label="Hue">
                </exo-select>
            </div>
            <div class="exo-1-cell">
                <div is="exo-modal" button-label="Labels" rounded="small" border-color="dark-gray" button-bg-color="light-gray"
                            id="edit_labels" button-text="Edit...">
                    <div style="padding:30px;">
                        <h4>Labels</h4>
                        <div class="exo-2-cell"><exo-text label="Title" id="title_label" full_width="true"></exo-text></div>
                        <div class="exo-2-cell"><exo-text label="X-Axis" id="x_axis_label" full_width="true"></exo-text></div>
                        <div class="exo-2-cell"><exo-text label="Y-Axis" id="y_axis_label" full_width="true"></exo-text></div>
                    </div>
                </div>
            </div>
            <div class="exo-1-cell">
                <label for="edit_bands" style="margin-top:0px;">Bands</label>
                <div is="exo-modal" label="aaa" rounded="small" border-color="dark-gray" button-bg-color="light-gray"
                            id="edit_bands" button-text="Edit...">
                    <div style="padding:30px;">
                        <h4>Bands</h4>
                        <div class="exo-2-cell">
                            <exo-checkbox id="use_custom" label="Set Manual Width" value="false">
                            </exo-checkbox>
                        </div>
                        <div class="exo-2-cell">
                            <exo-number step="0.01" id="custom_band_width" value="1" label="Band Width">
                            </exo-number>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="vizdiv">
        </div>
    </div>
</body>
</html>
